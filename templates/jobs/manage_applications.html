{% extends 'base.html' %}
{% block title %}Manage Applications{% endblock %}
{% block content %}
<h2 class="mb-3">Applications for Your Jobs</h2>
<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Job</th>
        <th>Applicant</th>
        <th>Resume</th>
        <th>Cover Letter</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for a in applications %}
      <tr>
        <td>{{ a.job.title }}</td>
        <td>{{ a.applicant.username }}</td>
        <td>
          {% if a.resume %}
            <a class="btn btn-sm btn-outline-primary" href="{{ a.resume.url }}" target="_blank" rel="noopener" download>
              View / Download
            </a>
          {% else %}
            <span class="text-muted">No resume</span>
          {% endif %}
        </td>
        <td>
          {% if a.cover_letter %}
            <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#coverModal-{{ a.id }}">
              View
            </button>
            <!-- Modal -->
            <div class="modal fade" id="coverModal-{{ a.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Cover Letter â€” {{ a.applicant.username }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <pre class="mb-0" style="white-space:pre-wrap;word-wrap:break-word;">{{ a.cover_letter }}</pre>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <span class="text-muted">No cover letter</span>
          {% endif %}
        </td>
        <td><span class="badge bg-secondary">{{ a.get_status_display }}</span></td>
        <td>
          <form class="d-flex gap-2" method="post">
            {% csrf_token %}
            <input type="hidden" name="application_id" value="{{ a.id }}" />
            <select class="form-select form-select-sm w-auto" name="status">
              {% for val,label in status_choices %}
              <option value="{{ val }}" {% if val == a.status %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
            <button class="btn btn-sm btn-primary" type="submit">Update</button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4"><div class="alert alert-info mb-0">No applications yet.</div></td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}



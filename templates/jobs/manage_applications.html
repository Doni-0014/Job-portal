{% extends 'base.html' %}
{% block title %}Manage Applications{% endblock %}
{% block content %}
<h1 class="mb-4 section-title">Applications for Your Jobs</h1>

{% if applications %}
<div class="table-responsive glass-card p-3">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-dark">
      <tr>
        <th><i class="bi bi-briefcase me-1"></i>Job Title</th>
        <th><i class="bi bi-person me-1"></i>Applicant</th>
        <th><i class="bi bi-file-earmark-pdf me-1"></i>Resume</th>
        <th><i class="bi bi-envelope me-1"></i>Cover Letter</th>
        <th><i class="bi bi-flag me-1"></i>Status</th>
        <th><i class="bi bi-gear me-1"></i>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for a in applications %}
      <tr>
        <td><a href="{% url 'job_detail' a.job.pk %}" class="text-decoration-none">{{ a.job.title }}</a></td>
        <td><strong>{{ a.applicant.username }}</strong></td>
        <td>
          {% if a.resume %}
            <a class="btn btn-sm btn-outline-info" href="{{ a.resume.url }}" target="_blank" rel="noopener" download>
              <i class="bi bi-download me-1"></i>View Resume
            </a>
          {% else %}
            <span class="text-muted"><i class="bi bi-x-circle me-1"></i>No resume</span>
          {% endif %}
        </td>
        <td>
          {% if a.cover_letter %}
            <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#coverModal-{{ a.id }}">
              <i class="bi bi-eye me-1"></i>View Letter
            </button>
            <!-- Modal -->
            <div class="modal fade" id="coverModal-{{ a.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Cover Letter â€” {{ a.applicant.username }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <pre class="mb-0" style="white-space:pre-wrap;word-wrap:break-word;">{{ a.cover_letter }}</pre>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <span class="text-muted">No cover letter</span>
          {% endif %}
        </td>
        <td>
          {% if a.status == 'pending' %}
            <span class="badge bg-warning text-dark">{{ a.get_status_display }}</span>
          {% elif a.status == 'accepted' %}
            <span class="badge bg-success">{{ a.get_status_display }}</span>
          {% elif a.status == 'rejected' %}
            <span class="badge bg-danger">{{ a.get_status_display }}</span>
          {% else %}
            <span class="badge bg-secondary">{{ a.get_status_display }}</span>
          {% endif %}
        </td>
        <td>
          <form class="d-flex gap-2" method="post">
            {% csrf_token %}
            <input type="hidden" name="application_id" value="{{ a.id }}" />
            <select class="form-select form-select-sm w-auto" name="status">
              {% for val,label in status_choices %}
              <option value="{{ val }}" {% if val == a.status %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
            <button class="btn btn-sm btn-primary" type="submit">
              <i class="bi bi-check-lg me-1"></i>Update
            </button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="6"><div class="alert alert-info mb-0 text-center">No applications yet.</div></td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="alert alert-info text-center" role="alert">
  <h4 class="alert-heading">No Applications Yet</h4>
  <p>You haven't received any applications for your jobs yet. Make sure your jobs are approved and visible to job seekers.</p>
  <hr>
  <p class="mb-0">
    <a href="{% url 'job_create' %}" class="btn btn-primary">Post a New Job</a>
    <a href="{% url 'job_list' %}" class="btn btn-outline-primary">Browse All Jobs</a>
  </p>
</div>
{% endif %}
{% endblock %}


